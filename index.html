<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Typing Game - News Edition</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background: #f9f9f9;
    }
    .hidden { display: none; }
    .centered {
      text-align: center;
      margin: 20px;
    }
    input[type="text"] {
      font-size: 24px;
      padding: 10px;
      width: 80%;
      max-width: 800px;
    }
    .feedback span.correct { color: green; }
    .feedback span.incorrect { color: red; }
    .controls button {
      font-size: 18px;
      margin: 5px;
      padding: 10px 20px;
    }
    .warning {
      color: red;
      font-weight: bold;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div id="home" class="centered">
    <h1>Typing Game - News Edition</h1>
    <p class="warning">⚠ 半角英数モードでタイピングしてください</p>
    <p>Select your game mode:</p>
    <div class="controls">
      <button onclick="startGame('questions', 1)">1 Question</button>
      <button onclick="startGame('questions', 10)">10 Questions</button>
      <button onclick="startGame('questions', 30)">30 Questions</button><br>
      <button onclick="startGame('timer', 60)">1 Minute</button>
      <button onclick="startGame('timer', 180)">3 Minutes</button>
      <button onclick="startGame('timer', 300)">5 Minutes</button>
    </div>
  </div>

  <div id="game" class="centered hidden">
    <h2 id="headline"></h2>
    <input type="text" id="input" inputmode="latin">
    <div id="feedback" class="feedback"></div>
    <p id="status"></p>
    <p id="warn" class="warning hidden">⚠ 全角文字が含まれています（半角に切り替えてください）</p>
    <button onclick="nextHeadline()">Next</button>
    <button onclick="goHome()">Home</button>
  </div>

  <script>
    const headlines = [
      "Chris Mason Labour still has a big persuasion job ahead",
      "Household energy bills fall but may not go much lower",
      "Is RFK Jrs divisive plan to Make America Healthy Again fearmongering or revolutionary",
      "I had to investigate my own abuse case because the police failed me",
      "Guilty plea expected over US student murders",
      "Royal train to be cut in Palace cost-saving measure",
      "Father and daughter plucked from sea after cruise ship drama",
      "Emma Raducanu beats British teenager Mimi Xu on first day of Wimbledon",
      "Heatwave peak sees parts of UK climb to 33C",
      "Hundreds of kids to be tested for disease in Australia after childcare rape charge",
      "Police launch criminal investigation into Bob Vylan and Kneecap Glastonbury sets",
      "Parental leave and pay for new parents to be reviewed",
      "What has been driving the rise in disability benefit claims",
      "The Papers Chaos on eve of welfare vote and Red-hot Brits",
      "Did BBCs focus on one potential Glastonbury controversy miss another",
      "As Squid Game ends South Koreans return to the reality that inspired it",
      "Were not safe here anymore Syrias Christians fear for future after devastating church attack",
      "How cold case killer was caught after more than half a century",
      "Trans troops in US military in survival mode as ban on serving kicks in",
      "Parents face hurdles vaccinating children report",
      "BBC investigation reveals hidden deaths at India festival crush",
      "US Senate begins voting on Trumps big beautiful bill",
      "Almost 2200 dog attacks on Royal Mail staff last year",
      "Tree that killed child was propped up for decades",
      "Food delivery apps to tighten checks to stop illegal workers",
      "Boulter and Kartal win on record-breaking day for British players",
      "The Fluminense history maker 44 with his eyes on Peter Shilton",
      "Putintseva asks umpire to eject spectator over safety fear",
      "Fifa should consider playing World Cup final at 9am",
      "Alcaraz avoids Fognini shock after fan taken ill"
    ];

    let shuffled = [];
    let current = 0;
    let mode = "questions";
    let limit = 10;
    let startTime = 0;
    let timer = null;
    let mistakeCount = 0;
    let charCount = 0;

    function shuffle(array) {
      let arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function startGame(selectedMode, value) {
      mode = selectedMode;
      limit = value;
      current = 0;
      mistakeCount = 0;
      charCount = 0;
      shuffled = shuffle(headlines);
      document.getElementById("home").classList.add("hidden");
      document.getElementById("game").classList.remove("hidden");
      countdown(3);
    }

    function countdown(seconds) {
      if (seconds === 0) {
        document.getElementById("headline").innerText = "";
        if (mode === 'timer') {
          startTime = Date.now();
          timer = setTimeout(() => finishGame(), limit * 1000);
        }
        setTimeout(() => nextHeadline(), 50);
        return;
      }
      document.getElementById("headline").innerText = `Starting in ${seconds}...`;
      setTimeout(() => countdown(seconds - 1), 1000);
    }

    function nextHeadline() {
      if (mode === 'questions' && current >= limit) return finishGame();
      if (mode === 'timer' && Date.now() - startTime >= limit * 1000) return finishGame();
      document.getElementById("input").value = "";
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("warn").classList.add("hidden");
      document.getElementById("headline").innerText = shuffled[current % shuffled.length];
      document.getElementById("input").focus();
      current++;
      updateStatus();
    }

    document.getElementById("input").addEventListener("keydown", function(e) {
      const target = document.getElementById("headline").innerText;
      const inputEl = document.getElementById("input");
      const feedback = document.getElementById("feedback");

      if (e.key.length === 1) {
        const input = inputEl.value + e.key;
        let html = "";
        let errors = 0;
        for (let i = 0; i < input.length; i++) {
          const correct = target[i] === input[i];
          const cls = correct ? "correct" : "incorrect";
          html += `<span class="${cls}">${input[i]}</span>`;
          if (!correct) errors++;
        }
        feedback.innerHTML = html;
        mistakeCount += errors;
        charCount += 1;
        updateStatus();
      }
    });

    document.getElementById("input").addEventListener("input", function(e) {
      const input = e.target.value;
      const hasZenkaku = /[^\u0000-\u00ff]/.test(input);
      document.getElementById("warn").classList.toggle("hidden", !hasZenkaku);
    });

    function updateStatus() {
      let text = `Mistakes: ${mistakeCount}`;
      if (mode === 'questions') text += ` | ${current} / ${limit}`;
      if (mode === 'timer') {
        const remaining = Math.max(0, limit - Math.floor((Date.now() - startTime) / 1000));
        text += ` | Time Left: ${remaining}s`;
      }
      document.getElementById("status").innerText = text;
    }

    function finishGame() {
      clearTimeout(timer);
      const score = charCount - mistakeCount * 2;
      alert(`Finished!\nScore: ${score}\nMistakes: ${mistakeCount}\nCharacters: ${charCount}`);
      goHome();
    }

    function goHome() {
      document.getElementById("game").classList.add("hidden");
      document.getElementById("home").classList.remove("hidden");
    }
  </script>
</body>
</html>
